// createAndPublishPaidArticle.js
// 有料記事を作成して自動投稿するスクリプト

import { runWithCore } from '@aa-0921/note-auto-core';

// アフィリエイト設定とリンクを別ファイルから読み込み
import { affiliateConfig, affiliateLinks } from './affiliateConfig.js';

// 再エクスポート（他のファイルから参照できるように）
export { affiliateConfig, affiliateLinks };

(async () => {
  await runWithCore(async ({ core, wantsBackground }) => {
    // アカウント固有の題材・切り口（ここで管理）
    // 「AI稼ぎ方.md」で扱っているテーマを中心に構成
    const topics = [
      'AIで記事の毎日投稿を自動化する方法',
      'AIで有料記事級のコンテンツを書く方法',
      'AI音楽で不労所得をつくる方法',
      'n8nとAIで自動アップセルする仕組み',
      'AIを使った副業の始め方',
      'AIでnoteの有料記事を量産する方法',
      'AIでnoteのコンテンツ作成時間を短縮する方法',
      'AIと自動化で継続収益をつくる考え方',
      'AIを相棒にして記事の質を上げる方法',
      'AIとワークフローで仕組み化する方法',
      'AIで不労所得の選択肢を広げる方法',
      'AIを使ってブログやnoteを自動化する方法',
    ];

    // 記事の切り口・構成のパターン
    // 「AI稼ぎ方.md」に書かれている構成パターンを反映
    const patterns = [
      '読者の悩みや課題から入る構成',
      'この方法で実現できることを最初に示す構成',
      '実績や成果を具体的な数字で見せる構成',
      'ステップバイステップで手順を解説する構成',
      '長期的な視点で収益化を考える構成',
      'AIの限界を認めつつ適切な使い方を提示する構成',
      '副業初心者にもわかりやすくかみ砕いて説明する構成',
      '自動化によって時間と手間を減らす価値を伝える構成',
      '不労所得の選択肢としてAIを位置づける構成',
      '具体的なツールやワークフローを紹介する構成',
      '読者の状況に寄り添って語りかける構成',
      '導入・本編・まとめの流れで整理して伝える構成',
    ];

    const rewriteConditionsLines = [
      'あなたはAIを活用した副業・自動化の専門家です。',
      '指定の見出し本文が短いため、200文字以上になるよう実体験や具体例、実践的なアドバイスを交えて厚くリライトしてください。',
      '読者は副業初心者〜中級者で、AIに興味はあるがまだうまく使いこなせていない人です。',
      '難しい専門用語はできるだけ避け、噛み砕いた説明で安心感を与えてください。',
      '【注意】',
      '- タイトルや見出しは出力せず、本文のみを返す。',
      '- メタ情報（追加要素や文字数など）は一切出力しない。',
      '- 丁寧な敬語（です・ます）で、読みやすさ重視。',
      '- 絵文字を多めに、各行に1つ程度。',
      '- 元の内容に沿い、noteのMarkdownのみ使用。',
      '- 箇条書きは「・ 」、番号付きリストは使わない。',
      '- 特殊トークンや制御文字（<|begin_of_sentence|>等）は絶対に出力しない。',
      '- 自然で読みやすい日本語のみを出力する。',
      '- 完成した文章のみを返し、システムメッセージや処理情報は含めない。',
      '- 日本語の文章の中に英単語を混ぜないでください。すべて日本語で表現してください。',
      '- 絵文字を使用する場合、その前後に句読点（。や、）は付けないでください。',
    ];

    // LLM用システムプロンプト（AI稼ぎ方.mdのテイストに準拠）
    const systemMessage =
      'あなたはAIを活用した副業・自動化の専門家で、日本語のnote記事編集者です。「AI稼ぎ方.md」にあるような、有料記事として価値のある構成と濃さで記事を作成してください。';

    // 記事生成プロンプト条件（AI稼ぎ方.mdの構成パターンを反映）
    const articleConditionsLines = [
      'タイトル、本文、ハッシュタグ（#から始まるもの）を含めてください。',
      'タイトルは1行目に「# [実際のタイトル]」として記載してください。',
      '「# タイトル」という文字列ではなく、実際の記事タイトルを入れてください。',
      'タイトルや本文には、できるだけ「AI」「自動化」「副業」「不労所得」などのキーワードを自然な形で盛り込んでください。',
      '本文にはタイトルを含めないでください。',
      '本文は見出しや箇条書きも交えて1000〜2000文字程度で丁寧にまとめてください。',
      'ハッシュタグは記事末尾に「#〇〇 #〇〇 ...」の形式でまとめてください。',
      'あなたはAIを活用した副業・自動化の専門家で、プロの編集者です。',
      '読みやすさを重視してください。',
      '構成は、次の流れを基本にしてください：「読者の悩み・現状」→「この方法で実現できること」→「実績や具体例」→「ステップバイステップの手順」→「長期的な視点や今後の伸ばし方」。',
      '導入では、読者が共感できる悩みや不安を書いてください。',
      '本文では、AIを丸投げではなく「相棒」や「編集者」として使う考え方を伝えてください。',
      '可能であればランキング形式やステップ形式を取り入れてください。',
      '改行を多めに入れてください。',
      '各行に1つ程度、絵文字を使用してください。',
      'すべて日本語で出力してください。',
      '切り口に沿った内容にしてください。',
      'noteの正しいマークダウン記法のみを使ってください。',
      '箇条書きはマークダウンではなく、「・ 」で表現してください。',
      '見出しはh2（## 見出し）・h3（### 見出し）のみ。',
      '見出しに「**」等は使わないでください。',
      '番号付きリストは使わないでください。',
      'h1（# タイトル）はタイトル行のみで本文中では使わないでください。',
      'その他のマークダウンやHTMLタグは使わないでください。',
      '【重要】特殊トークンや制御文字（<|begin_of_sentence|>、<｜begin▁of▁sentence｜>等）は絶対に出力しないでください。',
      '【重要】自然で読みやすい日本語のみを出力し、システムメッセージや処理情報は一切含めないでください。',
      '【重要】完成した記事のみを返してください。',
      '【重要】日本語の文章の中に英単語を混ぜないでください。すべて日本語で表現してください。',
      '【重要】絵文字を使用する場合、その前後に句読点（。や、）は付けないでください。',
    ];

    // タグ生成の指示文（参考実装：固定タグの必須含有を要求）
    const tagsInstruction =
      '記事内容から最も関連する日本語タグを3〜5個生成し、半角スペース区切りで出力してください。必ず「#引き寄せ #引き寄せの法則 #裏技 #PR」を含めてください。本文や説明は禁止。';

    // タイトル装飾用絵文字（参考実装のセット）
    const titleEmojis = [
      '❤️',
      '🌸',
      '🛑',
      '㊙︎',
      '🟥',
      '🈲',
      '🉐',
      '㊗️',
      '㊙️',
      '⭕',
      '‼️',
      '🎉',
    ];

    // ----------------------------------------------------------------------------------

    // 有料記事設定（AI稼ぎ方.mdの価格帯に寄せる）
    const paidEnabled = true; // 有料記事にするか
    // 価格をランダムに選択（AI稼ぎ方.mdを参考にした価格帯）
    const priceOptions = [1000, 1800, 2980];
    const price = priceOptions[Math.floor(Math.random() * priceOptions.length)];
    console.log(`選択された価格: ${price}円`);

    // 記事の自動生成と有料記事としての投稿機能を実行
    await core.runCreateAndPublishPaidArticle({
      background: wantsBackground,
      topics,
      patterns,
      paidEnabled,
      price,
      systemMessage,
      articleConditionsLines,
      rewriteConditionsLines,
      tagsInstruction,
      titleEmojis,
      // 有料記事ではアフィリエイトリンク、おすすめ記事セクションは不要（core側で無効化）
      affiliateLinks: [],
      magazinePromotion: [],
      amazonAssociateText: '',
      // おすすめ記事セクション設定（有料記事では不要）
      recommendedArticlesTitle: '',
      recommendedArticlesUrls: [],
    });
    console.log('有料記事の自動生成と投稿が完了しました');
  });
})();

