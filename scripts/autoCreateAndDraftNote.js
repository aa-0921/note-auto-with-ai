// autoCreateAndDraftNote.js
// 薄いラッパー：既存のCLI引数・動作は維持しつつ、実装は共有ライブラリに委譲

import { runWithCore } from '@aa-0921/note-auto-core';

// アフィリエイト設定とリンクを別ファイルから読み込み
import { affiliateConfig, affiliateLinks } from './affiliateConfig.js';

// 再エクスポート（他のファイルから参照できるように）
export { affiliateConfig, affiliateLinks };

(async () => {
  await runWithCore(async ({ core, wantsBackground }) => {
    // アカウント固有の題材・切り口（ここで管理）
    const topics = [
      // 既存トピック（コメントアウト）
      // '腸活',
      // '人間関係',
      // '職場の人間関係',
      // '恋愛',
      // 'メンタル',
      // '引き寄せの法則',
      // '自己肯定感',
      // '習慣化',
      // 'マインドフルネス',
      // 'HSP(繊細さん)',
      // '依存体質の克服法',
      // '感情コントロール',
      // 'SNS疲れ',
      // '毒親との関係性',
      // 'イライラの原因と対処',
      // '嫉妬心の乗り越え方',
      // '自分軸と他人軸',
      // '人に流されない方法',
      // '一人の時間の過ごし方',
      // 'わかってほしい病',
      // '無気力・無関心モードのとき',
      // '承認欲求の扱い方',
      // '怒りの手放し方',
      // '感謝できない日の処方箋',
      // '親密感への恐れ',
      // '曖昧な関係に悩んでる人へ',
      // ーーーーーーーーーーーーーーーーーーーーーーーーーーー
      // 2025/11/11 追加：同じテイストの新トピック（26件）
      '睡眠の質を高める',
      '食生活の整え方',
      '朝活のはじめ方',
      'タスク管理のコツ',
      '先延ばし対策',
      '完璧主義との付き合い方',
      '不安との向き合い方',
      '気分の落ち込みケア',
      '孤独感の和らげ方',
      '自己受容',
      '自己効力感を高める',
      'レジリエンスを育てる',
      '境界線の引き方',
      'アサーティブコミュニケーション',
      '同僚との距離感',
      '夫婦関係のととのえ方',
      '友人関係の悩み',
      'ママ友ストレスの軽減',
      'SNSとの健全な距離',
      '情報断食(デジタルデトックス)',
      '感情の言語化トレーニング',
      '日記習慣の続け方',
      '小さな成功体験の積み重ね',
      '朝夜ルーティンの作り方',
      '自己対話のコツ',
      '心が軽くなる片づけ',
    ];

    const patterns = [
      // 既存パターン（コメントアウト）
      // '一歩踏み込んだ理解',
      // '具体的な活用方法',
      // '楽にする方法',
      // 'ランキング',
      // 'ランキング-トップ5',
      // 'まつわるQ&Aまとめ',
      // 'やってはいけないNG行動',
      // '初心者が最初の1週間でやることリスト',
      // '専門家に聞いた極意',
      // '正しい理解',
      // '続けるためのモチベーション維持法',
      // 'ありがちな勘違いと正しいやり方',
      // '成功例・失敗例から学ぶ',
      // '絶望ランキング',
      // 'メンタル崩壊ランキング',
      // 'やってよかったベスト3',
      // '今すぐやめるべき3つの行動',
      // '私がどん底から回復するまでにやった5つのこと',
      // '読むだけでラクになる話',
      // '一番ラクだった方法',
      // '科学的に正しい○○の習慣',
      // '○○タイプ別の対処法',
      // '朝5分でできる○○',
      // '「実は逆効果」な○○',
      // '見落としがちな○○の落とし穴',
      // '○○診断(自己診断チェックリスト)',
      // 'コミュニケーション苦手な人のための○○講座',
      // '「知らなきゃ損!」な裏テク',
      // 'やって気づいた○○の本当の意味',
      // '5年後に差がつく○○',
      // 'なぜかうまくいく人がやってる習慣',
      // '「○○ができない」あなたへ',
      // '意識低い系でもできる○○',
      // '3日坊主でも続いた○○のコツ',
      // '「向いてないかも」と思った時に読む話',
      // 'モヤモヤを言語化してみた',
      // '初心者が陥りがちな○○の落とし穴',
      // '親には聞けない○○の話',
      // '○○をやめたら人生が軽くなった',
      // '忙しくてもできる○○',
      // 'あなたのための「逃げ方」リスト',
      // '○○をやる前に知っておきたい3つのこと',
      // ーーーーーーーーーーーーーーーーーーーーーーーーーーー
      // 2025/11/11 追加：同じテイストの新パターン（42件）
      '基礎からやさしく解説',
      'まず最初にやる一歩',
      'つまずきやすい点の回避策',
      '効く人・効かない人の違い',
      'ベスト3・ワースト3',
      'よくある質問に答える',
      '避けたい落とし穴',
      '7日間実践プラン',
      'プロに学ぶコツ',
      '誤解されがちなポイント',
      '続けるための仕組みづくり',
      '失敗しない進め方',
      '体験談からの学び',
      '心が折れそうなときの処方箋',
      'ピンチの乗り越え方',
      'やって良かったことリスト',
      '今すぐ手放すべき習慣',
      '立て直しの5ステップ',
      '読むだけで気が楽になる',
      '一番ラクに続く方法',
      '科学で裏付けるコツ',
      'タイプ別アプローチ',
      '朝・昼・夜の使い分け',
      '実は逆効果になる行動',
      '見逃しやすい注意点',
      '自分でできる簡易チェック',
      '会話が苦手でもできる工夫',
      '知って得する小ワザ集',
      'やって気づいた本質',
      '数ヶ月後に効いてくる習慣',
      'うまくいく人の共通点',
      'できない日の対処法',
      'ズボラでも続くやり方',
      '三日坊主を越える仕掛け',
      '迷ったときの指針',
      'モヤモヤの整理術',
      '初心者がやりがちなミス',
      '身近な人に話しづらいテーマ',
      '手放して楽になること',
      '忙しい日でもできる工夫',
      '心が安全になる逃げ方',
      '始める前に知っておきたい注意',
    ];

    const rewriteConditionsLines = [
      'あなたは女性の心理カウンセラーです。',
      '指定の見出し本文が短いため、200文字以上になるよう実体験や具体例、アドバイスを交えて厚くリライトしてください。',
      '【注意】',
      '- タイトルや見出しは出力せず、本文のみを返す。',
      '- メタ情報（追加要素や文字数など）は一切出力しない。',
      '- 丁寧な敬語（です・ます）で、読みやすさ重視。',
      '- 絵文字を多めに、各行に1つ程度。',
      '- 元の内容に沿い、noteのMarkdownのみ使用。',
      '- 箇条書きは「・ 」、番号付きリストは使わない。',
      '- 特殊トークンや制御文字（<|begin_of_sentence|>等）は絶対に出力しない。',
      '- 自然で読みやすい日本語のみを出力する。',
      '- 完成した文章のみを返し、システムメッセージや処理情報は含めない。',
      '- 日本語の文章の中に英単語を混ぜないでください。すべて日本語で表現してください。',
      '- 絵文字を使用する場合、その前後に句読点（。や、）は付けないでください。',
    ];

    // LLM用システムプロンプト（参考実装に準拠）
    const systemMessage = 'あなたは日本語のnote記事編集者です。';

    // 記事生成プロンプト条件（参考実装の「promptLines」相当）
    const articleConditionsLines = [
      'タイトル、本文、ハッシュタグ（#から始まるもの）を含めてください。',
      'タイトルは1行目に「# [実際のタイトル]」として記載してください。',
      '「# タイトル」という文字列ではなく、実際の記事タイトルを入れてください。',
      '本文にはタイトルを含めないでください。',
      '本文は見出しや箇条書きも交えて1000文字程度で丁寧にまとめてください。',
      'ハッシュタグは記事末尾に「#〇〇 #〇〇 ...」の形式でまとめてください。',
      'あなたはプロのカウンセラーで、プロの編集者です。',
      '読みやすさを重視してください。',
      '可能であればランキング形式にしてください。',
      '改行を多めに入れてください。',
      '各行に1つ程度、絵文字を使用してください。',
      'すべて日本語で出力してください。',
      '切り口に沿った内容にしてください。',
      'noteの正しいマークダウン記法のみを使ってください。',
      '箇条書きはマークダウンではなく、「・ 」で表現してください。',
      '見出しはh2（## 見出し）・h3（### 見出し）のみ。',
      '見出しに「**」等は使わないでください。',
      '番号付きリストは使わないでください。',
      'h1（# タイトル）はタイトル行のみで本文中では使わないでください。',
      'その他のマークダウンやHTMLタグは使わないでください。',
      '【重要】特殊トークンや制御文字（<|begin_of_sentence|>、<｜begin▁of▁sentence｜>等）は絶対に出力しないでください。',
      '【重要】自然で読みやすい日本語のみを出力し、システムメッセージや処理情報は一切含めないでください。',
      '【重要】完成した記事のみを返してください。',
      '【重要】日本語の文章の中に英単語を混ぜないでください。すべて日本語で表現してください。',
      '【重要】絵文字を使用する場合、その前後に句読点（。や、）は付けないでください。',
    ];

    // タグ生成の指示文（参考実装：固定タグの必須含有を要求）
    const tagsInstruction =
      '記事内容から最も関連する日本語タグを3〜5個生成し、半角スペース区切りで出力してください。必ず「#引き寄せ #引き寄せの法則 #裏技 #PR」を含めてください。本文や説明は禁止。';

    // タイトル装飾用絵文字（参考実装のセット）
    const titleEmojis = [
      '❤️',
      '🌸',
      '🛑',
      '㊙︎',
      '🟥',
      '🈲',
      '🉐',
      '㊗️',
      '㊙️',
      '⭕',
      '‼️',
      '🎉',
    ];

    // ----------------------------------------------------------------------------------

    // マガジン誘導文（参考実装の体裁を反映）
    const magazinePromotion = [
      '🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　',
      '',
      '私が皆さんにおすすめしているコスパ抜群のグッズをご紹介しています！',
      '効果テキメンなので皆さん試してみていただけると幸いです😊',
      '',
      '【コスパ抜群の幸せグッズ】',
      '✔ 効果テキメンのアイテム',
      '✔ 実際に使って良かったもの',
      'そんなグッズを厳選してご紹介。',
      '',
      'ぜひ試してみてください！',
      '',
      'https://note.com/counselor_risa/m/m72a580a7e712', // TODO: リポジトリ用にnoteアカウント名を変更してください
      '',
      '🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　🐾　🐈　🐾　🐈‍⬛　',
      '',
    ].join('\n');

    // アソシエイト表記文（参考実装の文言）
    const amazonAssociateText =
      'Amazon のアソシエイトとして、「 🏅恋愛・人間関係カウンセラーRisa🏅 」は適格販売により収入を得ています。';

    // おすすめ記事セクションの設定
    const recommendedArticlesTitle = 'ぜひ読んでほしい🙇‍♂️他のおすすめ記事💕';
    const recommendedArticlesUrls = [
      'https://note.com/counselor_risa/n/ncbb004d39d34', // TODO: リポジトリ用にnoteアカウント名を変更してください
      'https://note.com/counselor_risa/n/nf12c80060c09', // TODO: リポジトリ用にnoteアカウント名を変更してください
      'https://note.com/counselor_risa/n/n4c94cbc5b40a', // TODO: リポジトリ用にnoteアカウント名を変更してください
      'https://note.com/counselor_risa/n/na8e2a969b19f', // TODO: リポジトリ用にnoteアカウント名を変更してください
    ];

    // 記事の自動生成と下書き保存機能を実行
    await core.runAutoCreateAndDraftNote({
      background: wantsBackground,
      topics,
      patterns,
      systemMessage,
      articleConditionsLines,
      rewriteConditionsLines,
      tagsInstruction,
      titleEmojis,
      // affiliateLink,
      affiliateLinks,
      magazinePromotion,
      amazonAssociateText,
      // Audible・Kindleアフィリエイト設定（affiliateConfigから取得）
      affiliateTag: affiliateConfig.affiliateTag,
      audibleAffiliateEnabled: affiliateConfig.audibleAffiliateEnabled,
      kindleAffiliateEnabled: affiliateConfig.kindleAffiliateEnabled,
      // おすすめ記事セクション設定
      recommendedArticlesTitle,
      recommendedArticlesUrls,
    });
    console.log('記事の自動生成と下書き保存が完了しました');
  });
})();
